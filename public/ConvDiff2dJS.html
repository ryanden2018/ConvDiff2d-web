<!doctypehtml><html lang=en-us><head><meta charset=utf-8><meta content="text/html; charset=utf-8"http-equiv=Content-Type><title>Steady-state Advection-Diffusion Solver</title><style>.emscripten{padding-right:0;margin-left:auto;margin-right:auto;display:block}textarea.emscripten{font-family:monospace;width:80%}div.text1{padding:5px}div.text2{padding:15px}div.text1,div.text2,h2{color:#353535;font-family:'Lucida Sans','Lucida Sans Regular','Lucida Grande','Lucida Sans Unicode',Geneva,Verdana,sans-serif}div.text2{line-height:1.5}a:active,a:link,a:visited{color:#353535}a:hover{color:#000}div.emscripten{text-align:center}div.emscripten_border{border:1px solid #000}div.eqn{text-align:center}canvas.emscripten{border:0 none;background-color:#000;width:700px;height:700px}.spinner{height:50px;width:50px;margin:0 auto;-webkit-animation:rotation .8s linear infinite;-moz-animation:rotation .8s linear infinite;-o-animation:rotation .8s linear infinite;animation:rotation .8s linear infinite;border-left:10px solid #0096f0;border-right:10px solid #0096f0;border-bottom:10px solid #0096f0;border-top:10px solid #6400c8;border-radius:100%;background-color:#c864fa}@-webkit-keyframes rotation{from{-webkit-transform:rotate(0)}to{-webkit-transform:rotate(360deg)}}@-moz-keyframes rotation{from{-moz-transform:rotate(0)}to{-moz-transform:rotate(360deg)}}@-o-keyframes rotation{from{-o-transform:rotate(0)}to{-o-transform:rotate(360deg)}}@keyframes rotation{from{transform:rotate(0)}to{transform:rotate(360deg)}}</style></head><body><h2>Steady-state Advection-Diffusion Solver</h2><div class=text1><i>Ryan Denlinger</i></div><div class=text1>This is the JavaScript version; a  <a href=ConvDiff2d.html>WebAssembly version</a>  is also available.</div><div class=text1><b>CLICK</b>  or  <b>CLICK AND DRAG</b>  to alter the flow velocity.</div><div class=text1>(<b>TOUCH</b>  or  <b>TOUCH AND DRAG</b>  on touch-enabled devices.)</div><div class=text1>The code for this demo is available on  <a href=https://github.com/ryanden2018/ConvDiff2d/ target=_blank>GitHub</a>.</div><div class=text1>An explanation of the math behind this demo is provided below.</div><hr><figure id=spinner style=overflow:visible><div class=spinner></div><center style=margin-top:.5em><strong>emscripten</strong></center></figure><div class=emscripten id=status>Downloading...</div><div class=emscripten><progress hidden id=progress max=100 value=0></progress></div><div class=emscripten_border><canvas class=emscripten id=canvas oncontextmenu=event.preventDefault() tabindex=-1></canvas></div><textarea class=emscripten id=output rows=8></textarea><hr><h2>What is this?</h2><div class=text2>An advection-diffusion equation is a partial differential equation (PDE) which describes a spreading (diffusing) concentration distribution under the influence of some external flow velocity. The canonical example is:</div><div class=eqn><img height=75 src=eq1.png></div><div class=text2>where  <i>f</i>  is the concentration and  <i>g</i>  is the source. In this demo we are solving a steady-state version of this equation, obtained by setting the time derivative to zero (<i>g</i>  must have mean zero):</div><div class=eqn><img height=75 src=eq2.png></div><div class=text2>Additionally we set the velocity  <b>u</b>  to a constant, which starts at zero and is thereafter determined through user interaction. The PDE is solved on a unit square with periodic boundary conditions. The right-hand side is given by the following formula:</div><div class=eqn><img height=75 src=eq3.png></div><div class=text2>where</div><div class=eqn><img height=75 src=eq4.png></div><div class=text2>The numerical method for this demo is the Discontinuous Gelerkin (DG) method (with penalty to handle the diffusion). DG is an alternative to classical finite element (FEM) and finite volume (FVM) methods, and arises by combining aspects of both. In the DG method, we expand the solution in a basis of piecewise polynomial functions, and integrate against test functions from the same space to generate a discrete system of equations. In particular the computed solution is typically discontinuous. Compared to FVM, DG provides simpler facilities for producing high-order methods. Compared to FEM, DG provides greater flexibility in gridding, and hence, adaptive refinement. Note carefully that in both cases we are referring to the  <i>ease</i>  of obtaining a benefit; FVM can be high-order and FEM can be made adaptive.</div><div class=text2><i>Remark:</i>  The astute reader will observe that the problem statement is given in a smooth periodic setting, and hence, a spectral method would be most appropriate.  <b>This is true.</b>  However, spectral methods are generally difficult to employ in complex geometries or in non-smooth functional settings. FVM, FEM and DG methods are well-suited to complex geometries and non-smooth function spaces. The point of this demo was to demonstrate the feasibility of a generic PDE solver in a web browser, and a generic solver like DG is the correct choice for such a demonstration.</div><div class=text2>The demo actually solves two problems: a fast one, and a slow one. The fast solve employs a 11 by 11 grid with linear basis functions in each cell (a 363 by 363 system). The slow solve employs a 20 by 20 grid with cubic basis functions in each cell (a 4000 by 4000 system). Discontinuities are expected along cell boundaries and this is actually visible for the fast solve in the demo (though both solves feature discontinuities).</div><div class=text2>The console window will display two numbers at the conclusion of each slow solve. The first number is the residual from solving the linear system; this number is expected to be small because it does not account for truncation error. The second number is the spatial residual computed via the following formula:</div><div class=eqn><img height=100 src=eq5.png></div><div class=text2>To compute the derivatives appearing in the residual, high-order finite difference formulas are applied to the solution values evaluated at cell centers.</div><div class=text2>The DG solver is written in C++, using the  <a href=http://eigen.tuxfamily.org target=_blank>Eigen</a>  package for linear algebra and  <a href=https://emscripten.org/ target=_blank>Emscripten</a>  to compile down to WebAssembly.</div><script>var statusElement=document.getElementById("status"),progressElement=document.getElementById("progress"),spinnerElement=document.getElementById("spinner"),Module={preRun:[],postRun:[],print:function(){var e=document.getElementById("output");return e&&(e.value=""),function(t){arguments.length>1&&(t=Array.prototype.slice.call(arguments).join(" ")),console.log(t),e&&(e.value+=t+"\n",e.scrollTop=e.scrollHeight)}}(),printErr:function(e){arguments.length>1&&(e=Array.prototype.slice.call(arguments).join(" ")),console.error(e)},canvas:function(){var e=document.getElementById("canvas");return e.addEventListener("webglcontextlost",(function(e){alert("WebGL context lost. You will need to reload the page."),e.preventDefault()}),!1),e}(),setStatus:function(e){if(Module.setStatus.last||(Module.setStatus.last={time:Date.now(),text:""}),e!==Module.setStatus.last.text){var t=e.match(/([^(]+)\((\d+(\.\d+)?)\/(\d+)\)/),n=Date.now();t&&n-Module.setStatus.last.time<30||(Module.setStatus.last.time=n,Module.setStatus.last.text=e,t?(e=t[1],progressElement.value=100*parseInt(t[2]),progressElement.max=100*parseInt(t[4]),progressElement.hidden=!1,spinnerElement.hidden=!1):(progressElement.value=null,progressElement.max=null,progressElement.hidden=!0,e||(spinnerElement.hidden=!0)),statusElement.innerHTML=e)}},totalDependencies:0,monitorRunDependencies:function(e){this.totalDependencies=Math.max(this.totalDependencies,e),Module.setStatus(e?"Preparing... ("+(this.totalDependencies-e)+"/"+this.totalDependencies+")":"All downloads complete.")}};Module.setStatus("Downloading..."),window.onerror=function(){Module.setStatus("Exception thrown, see JavaScript console"),spinnerElement.style.display="none",Module.setStatus=function(e){e&&Module.printErr("[post-exception status] "+e)}}</script><script>var ASSERTIONS=0,dataURIPrefix="data:application/octet-stream;base64,";function isDataURI(e){return String.prototype.startsWith?e.startsWith(dataURIPrefix):0===e.indexOf(dataURIPrefix)}var decodeBase64="function"==typeof atob?atob:function(e){var r,t,i,n,a,o,f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",m="",s=0;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{r=f.indexOf(e.charAt(s++))<<2|(n=f.indexOf(e.charAt(s++)))>>4,t=(15&n)<<4|(a=f.indexOf(e.charAt(s++)))>>2,i=(3&a)<<6|(o=f.indexOf(e.charAt(s++))),m+=String.fromCharCode(r),64!==a&&(m+=String.fromCharCode(t)),64!==o&&(m+=String.fromCharCode(i))}while(s<e.length);return m};function intArrayFromBase64(e){if("boolean"==typeof ENVIRONMENT_IS_NODE&&ENVIRONMENT_IS_NODE){var r;try{r=Buffer.from(e,"base64")}catch(t){r=new Buffer(e,"base64")}return new Uint8Array(r.buffer,r.byteOffset,r.byteLength)}try{for(var t=decodeBase64(e),i=new Uint8Array(t.length),n=0;n<t.length;++n)i[n]=t.charCodeAt(n);return i}catch(e){throw new Error("Converting base64 string to bytes failed.")}}function tryParseAsDataURI(e){if(isDataURI(e))return intArrayFromBase64(e.slice(dataURIPrefix.length))}function intArrayFromString(e,r,t){var i=t>0?t:lengthBytesUTF8(e)+1,n=new Array(i),a=stringToUTF8Array(e,n,0,n.length);return r&&(n.length=a),n}function intArrayToString(e){for(var r=[],t=0;t<e.length;t++){var i=e[t];i>255&&(ASSERTIONS&&assert(!1,"Character code "+i+" ("+String.fromCharCode(i)+")  at offset "+t+" not in 0x00-0xFF."),i&=255),r.push(String.fromCharCode(i))}return r.join("")}var memoryInitializer="ConvDiff2dJS.html.mem";memoryInitializer=Module.locateFile?Module.locateFile(memoryInitializer,""):memoryInitializer,Module.memoryInitializerRequestURL=memoryInitializer;var meminitXHR=Module.memoryInitializerRequest=new XMLHttpRequest;meminitXHR.open("GET",memoryInitializer,!0),meminitXHR.responseType="arraybuffer",meminitXHR.send(null);var script=document.createElement("script");script.src="ConvDiff2dJS.js",document.body.appendChild(script)</script></body></html>